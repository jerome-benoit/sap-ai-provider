---
alwaysApply: true
description: Guide to repository structure and file locations for SAP AI Provider
---

# Project Structure Guide

This repository provides an SAP AI Provider compatible with the Vercel AI
SDK. Use these anchors to navigate the codebase quickly.

## Source Files

```text
src/
├── index.ts                                        # V3 public API exports
├── index-v2.ts                                     # V2 public API exports (facade)
│
│   # V3 Implementation (LanguageModelV3/EmbeddingModelV3)
├── sap-ai-provider.ts                              # V3 provider factory
├── sap-ai-language-model.ts                        # V3 language model
├── sap-ai-embedding-model.ts                       # V3 embedding model
│
│   # V2 Facade Layer (LanguageModelV2/EmbeddingModelV2)
├── sap-ai-provider-v2.ts                           # V2 provider factory (wraps V3)
├── sap-ai-language-model-v2.ts                     # V2 language model (wraps V3)
├── sap-ai-embedding-model-v2.ts                    # V2 embedding model (wraps V3)
├── sap-ai-adapters-v3-to-v2.ts                     # V3→V2 format conversion
│
│   # Shared Infrastructure
├── sap-ai-provider-options.ts                      # Provider options & Zod schemas
├── sap-ai-settings.ts                              # Settings and type definitions
├── sap-ai-error.ts                                 # Error handling system
├── sap-ai-validation.ts                            # API resolution & validation
├── sap-ai-strategy.ts                              # Strategy factory (lazy loading)
├── strategy-utils.ts                               # Shared strategy utilities
├── base-language-model-strategy.ts                 # Base class for language model strategies (Template Method)
├── base-embedding-model-strategy.ts                # Base class for embedding model strategies (Template Method)
├── orchestration-language-model-strategy.ts       # Orchestration API strategy
├── orchestration-embedding-model-strategy.ts      # Orchestration embedding strategy
├── foundation-models-language-model-strategy.ts   # Foundation Models API strategy
├── foundation-models-embedding-model-strategy.ts  # Foundation Models embedding strategy
├── convert-to-sap-messages.ts                     # Message format conversion
├── deep-merge.ts                                   # Deep merge utility
└── version.ts                                      # Package version constant
```

## Entry Points and Core Modules

### V3 Package (`@jerome-benoit/sap-ai-provider`)

- Entry: [src/index.ts](mdc:src/index.ts)
- Provider: [src/sap-ai-provider.ts](mdc:src/sap-ai-provider.ts)
  - `createSAPAIProvider(options)` returns `ProviderV3`.
  - Methods: `embedding()`, `embeddingModel()`, `textEmbeddingModel()`.
- Language model: [src/sap-ai-language-model.ts](mdc:src/sap-ai-language-model.ts)
  - Implements `LanguageModelV3` contract.
- Embedding model: [src/sap-ai-embedding-model.ts](mdc:src/sap-ai-embedding-model.ts)
  - Implements `EmbeddingModelV3` contract.

### V2 Package (`@jerome-benoit/sap-ai-provider-v2`)

- Entry: [src/index-v2.ts](mdc:src/index-v2.ts)
- Provider: [src/sap-ai-provider-v2.ts](mdc:src/sap-ai-provider-v2.ts)
  - `createSAPAIProvider(options)` returns `ProviderV2`.
  - Methods: `chat()`, `languageModel()`, `textEmbeddingModel()` (V2 spec).
  - **Note:** V2 does NOT have `embedding()` or `embeddingModel()` aliases.
- Language model: [src/sap-ai-language-model-v2.ts](mdc:src/sap-ai-language-model-v2.ts)
  - Implements `LanguageModelV2`, wraps V3 internally.
- Embedding model: [src/sap-ai-embedding-model-v2.ts](mdc:src/sap-ai-embedding-model-v2.ts)
  - Implements `EmbeddingModelV2`, wraps V3 internally.
- Adapters: [src/sap-ai-adapters-v3-to-v2.ts](mdc:src/sap-ai-adapters-v3-to-v2.ts)
  - Converts V3 responses to V2 format.

### Shared Infrastructure

- Provider options: [src/sap-ai-provider-options.ts](mdc:src/sap-ai-provider-options.ts)
- Settings and types: [src/sap-ai-settings.ts](mdc:src/sap-ai-settings.ts)
- Error handling: [src/sap-ai-error.ts](mdc:src/sap-ai-error.ts)
- API validation: [src/sap-ai-validation.ts](mdc:src/sap-ai-validation.ts)
- Strategy factory: [src/sap-ai-strategy.ts](mdc:src/sap-ai-strategy.ts)
- Strategy utilities: [src/strategy-utils.ts](mdc:src/strategy-utils.ts)
- Base language model strategy: [src/base-language-model-strategy.ts](mdc:src/base-language-model-strategy.ts)
- Message conversion: [src/convert-to-sap-messages.ts](mdc:src/convert-to-sap-messages.ts)
- Deep merge utility: [src/deep-merge.ts](mdc:src/deep-merge.ts)
- Version constant: [src/version.ts](mdc:src/version.ts)

## API Strategy Files

- Orchestration language model:
  [src/orchestration-language-model-strategy.ts](mdc:src/orchestration-language-model-strategy.ts)
- Orchestration embedding model:
  [src/orchestration-embedding-model-strategy.ts](mdc:src/orchestration-embedding-model-strategy.ts)
- Foundation Models language model:
  [src/foundation-models-language-model-strategy.ts](mdc:src/foundation-models-language-model-strategy.ts)
- Foundation Models embedding model:
  [src/foundation-models-embedding-model-strategy.ts](mdc:src/foundation-models-embedding-model-strategy.ts)

## Build, Types, and Distribution

- TypeScript config: [tsconfig.json](mdc:tsconfig.json)
- V3 build config: [tsup.config.ts](mdc:tsup.config.ts)
- V2 build config: [tsup.config.v2.ts](mdc:tsup.config.v2.ts)
- V2 publish script: [scripts/prepare-v2-package.ts](mdc:scripts/prepare-v2-package.ts)
- ESLint config: [eslint.config.js](mdc:eslint.config.js)
- Output: [dist/](mdc:dist/) produces V3 (`index.js`, `index.cjs`, `index.d.ts`,
  `index.d.cts`) and V2 (`index-v2.js`, `index-v2.cjs`, `index-v2.d.ts`) with
  sourcemaps.
- `package.json` exports are aligned for Node and ESM:
  [package.json](mdc:package.json)

### Build Commands

- `npm run build` — Build V3 package
- `npm run build:v2` — Build V2 package
- `npm run prepare:v2` — Prepare V2 for publishing (renames files)

## Testing

- Node environment tests: [vitest.node.config.ts](mdc:vitest.node.config.ts)
- Edge runtime tests: [vitest.edge.config.ts](mdc:vitest.edge.config.ts)

## Examples and Docs

- README with usage and configuration: [README.md](mdc:README.md)
- Complete API reference: [API_REFERENCE.md](mdc:API_REFERENCE.md)
- Architecture documentation: [ARCHITECTURE.md](mdc:ARCHITECTURE.md)
- Contribution guidelines: [CONTRIBUTING.md](mdc:CONTRIBUTING.md)
- Environment setup guide: [ENVIRONMENT_SETUP.md](mdc:ENVIRONMENT_SETUP.md)
- Troubleshooting guide: [TROUBLESHOOTING.md](mdc:TROUBLESHOOTING.md)
- Migration guide: [MIGRATION_GUIDE.md](mdc:MIGRATION_GUIDE.md)
- cURL API testing guide:
  [CURL_API_TESTING_GUIDE.md](mdc:CURL_API_TESTING_GUIDE.md)
- AI agent instructions: [AGENTS.md](mdc:AGENTS.md)
- Examples: [examples/](mdc:examples/)
  - Chat completion:
    [examples/example-simple-chat-completion.ts](mdc:examples/example-simple-chat-completion.ts)
  - Tool calling:
    [examples/example-chat-completion-tool.ts](mdc:examples/example-chat-completion-tool.ts)
  - Image recognition:
    [examples/example-image-recognition.ts](mdc:examples/example-image-recognition.ts)
  - Text generation:
    [examples/example-generate-text.ts](mdc:examples/example-generate-text.ts)
  - Data masking:
    [examples/example-data-masking.ts](mdc:examples/example-data-masking.ts)
  - Streaming:
    [examples/example-streaming-chat.ts](mdc:examples/example-streaming-chat.ts)
  - Document grounding (RAG):
    [examples/example-document-grounding.ts](mdc:examples/example-document-grounding.ts)
  - Translation:
    [examples/example-translation.ts](mdc:examples/example-translation.ts)
  - Embeddings:
    [examples/example-embeddings.ts](mdc:examples/example-embeddings.ts)
  - Foundation Models API:
    [examples/example-foundation-models.ts](mdc:examples/example-foundation-models.ts)

## Runtime Requirements

- Node.js >= 20 (see `engines` in [package.json](mdc:package.json)).
- Authentication is handled automatically by SAP AI SDK:
  - On SAP BTP: Uses service binding (VCAP_SERVICES)
  - Locally: Uses AICORE_SERVICE_KEY environment variable
