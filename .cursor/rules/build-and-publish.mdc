---
description: Build, type-check, test, and publish workflow for the package
---

# Build and Publish

## Build Outputs

- Bundler: tsup (CJS + ESM + DTS + sourcemaps) — see
  [tsup.config.ts](mdc:tsup.config.ts) and [tsup.config.v2.ts](mdc:tsup.config.v2.ts)
- Output dir: [dist/](mdc:dist/)
- Package exports configured in [package.json](mdc:package.json)

## Commands

### Build Commands

- Build V3: `npm run build`
- Watch V3 build: `npm run build:watch`
- Build V2: `npm run build:v2`
- Watch V2 build: `npm run build:v2:watch`
- Prepare V2 for npm publish: `npm run prepare:v2` (renames files for package)
- Check build outputs: `npm run check-build`

### Quality Checks

- Type-check: `npm run type-check`
- Lint: `npm run lint`
- Lint-fix: `npm run lint-fix`
- Prettier-check: `npm run prettier-check`
- Prettier-fix: `npm run prettier-fix`
- Test: `npm test`

### Dual-Package Architecture

This repository publishes two npm packages from the same codebase:

- `@jerome-benoit/sap-ai-provider` (V3) — Built from `src/index.ts`, uses `LanguageModelV3`/`EmbeddingModelV3`
- `@jerome-benoit/sap-ai-provider-v2` (V2) — Built from `src/index-v2.ts`, wraps V3 internally to expose `LanguageModelV2`/`EmbeddingModelV2`

`prepublishOnly` runs the appropriate build and verification before publish:

- V3 (default): `build && check-build`
- V2 (when `AI_SDK_VERSION=v2`): `build:v2 && check-build:v2 && prepare:v2`

See [package.json](mdc:package.json) for the full script.

## Node Engine

- Requires Node >= 20 (see `engines` in [package.json](mdc:package.json)).

## Verification

- Verify distribution artifacts exist: `npm run check-build`.
